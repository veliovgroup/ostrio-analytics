/*! ostrio-analytics v2.0.0 | BSD-3-Clause */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t="undefined"!=typeof globalThis?globalThis:t||self).OstrioTrackerClass=r()}(this,function(){"use strict";var t;!function(t){t.Fetch="fetch",t.Beacon="beacon",t.Img="img"}(t||(t={}));var r,e=[t.Fetch,t.Beacon,t.Img],n="https://analytics.ostr.io/",i=300,o=500,s=64,a={msg:"N/A",url:"",line:"0",column:"0"},c={credentials:"include",mode:"no-cors",cache:"no-store"};!function(t){t.GlobalError="[Global Error]",t.HashChange="hashchange",t.PopState="popstate",t.UnhandledRejection="unhandledrejection"}(r||(r={}));var h="6",l="2",u="1",f="3",d="9",g="v",p="11",v=1024,m=1024,y=512,k=24,w=64,E=512,T="[init] {{trackingId}} is missing or incorrect!",S="[pushEvent] Can't add event without key or value!",U="[track] [fetch] Error:",A=function(){function A(r,e){this.version=i,this.sending=!1,this.loc=globalThis.location,this.current="",this.trackHash=!0,this.trackQuery=!0,this.ignoredQueries=new Set,this.transport=t.Fetch,this.serviceUrl=n,this.ignoredPaths=new Set,this.onTrackArr=[],this.onEventArr=[],this.cachedErrors=new Set,this.eventRemovers=[],this.autoTimer=null,this.lastTrackTimestamp=!1;var o="boolean"==typeof e?{auto:e}:e||{};this.sid=r,this.auto=!(!1===o.auto),this.trackErrors=!(!1===o.trackErrors),o.ignoredQueries&&this.ignoreQueries(o.ignoredQueries),o.ignoredPaths&&this.ignorePaths(o.ignoredPaths),this.applySettings(o),this.warn=function(){if("undefined"!=typeof console){var t="function"==typeof console.warn?console.warn:"function"==typeof console.log?console.log:null;if(t){var r=Array.from(arguments);r.unshift("[ostrio]"),t.apply(console,r)}}},this.sid&&"string"==typeof this.sid&&17===this.sid.length?(this.auto&&this.initAutoTracking(),this.trackErrors&&this.initGlobalErrors()):this.warn(T)}return A.prototype.on=function(t,r,e){t.addEventListener(r,e,!1),this.eventRemovers.push(function(){t.removeEventListener(r,e,!1)})},A.prototype.applySettings=function(t){void 0!==t.trackHash&&(this.trackHash=!(!1===t.trackHash)),void 0!==t.trackQuery&&(this.trackQuery=!(!1===t.trackQuery)),t.serviceUrl&&"string"==typeof t.serviceUrl&&t.serviceUrl.length&&(this.serviceUrl=t.serviceUrl,this.serviceUrl=this.serviceUrl.endsWith("/")?this.serviceUrl:"".concat(this.serviceUrl,"/")),t.transport&&this.setTransport(t.transport)},A.prototype.setTransport=function(t){e.includes(t)&&(this.transport=t)},A.prototype.ignorePath=function(t){this.ignoredPaths.add(t)},A.prototype.ignorePaths=function(t){Array.isArray(t)&&t.forEach(this.ignorePath.bind(this))},A.prototype.ignoreQuery=function(t){this.ignoredQueries.add(t.toLowerCase())},A.prototype.ignoreQueries=function(t){Array.isArray(t)&&t.forEach(this.ignoreQuery.bind(this))},A.prototype.onPushEvent=function(t){"function"==typeof t&&this.onEventArr.push(t)},A.prototype.onTrack=function(t){"function"==typeof t&&this.onTrackArr.push(t)},A.prototype.pushEvent=function(t,e){var n,i,o=String(t).trim(),s=String(e).trim();if(o&&s){for(var a=this.onEventArr.length-1;a>=0;a--)null===(i=(n=this.onEventArr)[a])||void 0===i||i.call(n,t,e);var c={};if(o===r.GlobalError){if(s=s.trim().slice(0,E),this.cachedErrors.has(s))return;this.cachedErrors.add(s)}else s=s.trim().slice(0,w);c[o=o.trim().slice(0,k)]=s;var h=new URLSearchParams;h.set(f,JSON.stringify(c)),this.send(h)}else this.warn(S)},A.prototype.track=function(){var t,r;if(this.isIgnored(this.loc.pathname))return!1;for(var e=this.onTrackArr.length-1;e>=0;e--)null===(r=(t=this.onTrackArr)[e])||void 0===r||r.call(t);return this.send(new URLSearchParams)},A.prototype.send=function(t){var r=this;return t.set(d,String(Date.now()).slice(-7)),t.set(g,String(this.version)),t.has(f)?(this.fetch(t,function(){}),!0):!this.sending&&this.current!==this.getCurrentUrl()&&(this.sending=!0,setTimeout(function(){r.current=r.getCurrentUrl(),r.lastTrackTimestamp&&t.set(p,String(r.lastTrackTimestamp)),r.lastTrackTimestamp=Date.now(),t.set(h,r.current.slice(0,v)),t.set(l,document.title.trim().slice(0,y)),document.referrer&&-1===document.referrer.indexOf(r.loc.origin)&&t.set(u,document.referrer.trim().slice(0,m)),r.fetch(t,function(){r.sending=!1})},s),!0)},A.prototype.fetch=function(r,e){var n=this,i="".concat(this.serviceUrl).concat(this.sid,".gif?").concat(r.toString());if(this.transport===t.Beacon&&"sendBeacon"in navigator)return navigator.sendBeacon(i),void e();if(this.transport===t.Img){var o="Image"in window?new Image:document.createElement("img");return o.onload=function(){o=null},o.src=i,void e()}fetch(i,c).then(e).catch(function(t){n.warn(U,t),e()})},A.prototype.initAutoTracking=function(){var t=this,e=function(){t.track()};this.trackHash&&this.on(window,r.HashChange,e),this.on(window,r.PopState,e),this.autoTimer=setInterval(function(){t.sending||t.current===t.getCurrentUrl()||e()},o),e()},A.prototype.initGlobalErrors=function(){var t=this,e=window.onerror;window.onerror=function(n,i,o,s,c){var h=String(n||a.msg),l=String(i||a.url),u=String(o||a.line),f=String(s||a.column);l.includes(t.loc.origin)&&t.pushEvent(r.GlobalError,"Error: ".concat(h,". File: ").concat(l.replace(t.loc.origin,"")," at ").concat(t.loc.href,":").concat(u,":").concat(f)),"function"==typeof e&&e.call(window,n,i,o,s,c)},this.on(window,r.UnhandledRejection,function(e){var n,i=e,o=i&&"object"==typeof i.reason&&i.reason&&"message"in i.reason?String(i.reason.message):String(null!==(n=null==i?void 0:i.reason)&&void 0!==n?n:"Undefined Rejection Reason");t.pushEvent(r.GlobalError,"Unhandled Rejection: ".concat(o,". At: ").concat(t.loc.href))})},A.prototype.isIgnored=function(t){if(!this.ignoredPaths.size)return!1;for(var r=Array.from(this.ignoredPaths),e=r.length-1;e>=0;e--){var n=r[e];if("string"==typeof n){if(n.endsWith("*")){var i=n.slice(0,-1);if(t.startsWith(i))return!0}else if(t===n)return!0}else if(n instanceof RegExp&&n.test(t))return!0}return!1},A.prototype.getCurrentUrl=function(){var t=this,r=new URL(this.loc.href);return this.trackHash||(r.hash=""),this.trackQuery?this.ignoredQueries.size&&Array.from(r.searchParams.keys()).forEach(function(e){t.ignoredQueries.has(e.toLowerCase())&&r.searchParams.delete(e)}):r.search="",r.href},A.prototype.destroy=function(){for(var t,r,e=this.eventRemovers.length-1;e>=0;e--)null===(r=(t=this.eventRemovers)[e])||void 0===r||r.call(t);this.eventRemovers.length=0,this.autoTimer&&(clearInterval(this.autoTimer),this.autoTimer=null)},A}();return A});
//# sourceMappingURL=ostrio-analytics.min.js.map
